name: Android CI Build

on:
  push:
    branches: [ "principal" ] # Verifique se sua branch é 'principal' ou 'main'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    # PASSO 1: Descompacta o seu arquivo ZIP
    - name: Unzip Project Files
      run: unzip AviatorAssist.zip
    
    # PASSO 2: CORREÇÃO DO ERRO 'Could not find com.android.tools.build:gradle'
    # Adiciona o repositório 'google()' para que o Gradle possa encontrar o plugin 8.4.1
    - name: Fix Missing Google Repository
      run: |
        sed -i '/pluginManagement {/a \ \ \ \ repositories {\n \ \ \ \ \ \ \ \ google()\n \ \ \ \ \ \ \ \ mavenCentral()\n \ \ \ \ }' AviatorAssist/settings.gradle

    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    # PASSO 3: Compilação usando o caminho CORRETO: AviatorAssist/
    - name: Build debug APK
      run: |
        chmod +x AviatorAssist/gradlew 
        ./AviatorAssist/gradlew assembleDebug

    # PASSO 4: Upload do APK
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: AviatorAssist-APK
        path: AviatorAssist/app/build/outputs/apk/debug/app-debug.apk
